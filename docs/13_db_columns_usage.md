# Описание столбцов БД и их назначение

Документ описывает каждую таблицу и назначение её столбцов: где используется поле и какая информация в него записывается.

## users
- `id` — UUID пользователя, первичный ключ; используется как стабильный идентификатор во всех связях (roles, sales, refunds).
- `email` — логин пользователя; используется при аутентификации и для отображения в админке, уникален в рамках арендатора.
- `password_hash` — bcrypt-хэш пароля; используется при проверке логина.
- `is_active` — флаг активного доступа; определяет, может ли пользователь входить в систему.
- `created_at` — момент создания записи; используется для аудита и отображения в админке.
- `last_login_at` — время последнего входа; обновляется при успешной аутентификации.
- `tenant_id` — ссылка на `tenants.id`; определяет арендатора (компанию), в рамках которого существует пользователь.

## roles
- `id` — UUID роли, первичный ключ.
- `name` — имя роли (например, `owner`, `admin`, `cashier`); используется для прав доступа.
- `tenant_id` — ссылка на `tenants.id`; роль принадлежит конкретному арендатору.

## user_roles
- `user_id` — ссылка на `users.id`; определяет пользователя.
- `role_id` — ссылка на `roles.id`; определяет назначенную роль.
- `tenant_id` — ссылка на `tenants.id`; хранится для фильтрации по арендатору.

## tenants
- `id` — UUID арендатора, первичный ключ; используется во всех сущностях как `tenant_id`.
- `name` — отображаемое название компании.
- `code` — уникальный код арендатора; используется для технической идентификации.
- `status` — статус (`active`/`inactive`); управляет доступностью арендатора.
- `created_at` — время создания арендатора.
- `updated_at` — время последнего обновления арендатора.

## categories
- `id` — UUID категории, первичный ключ.
- `name` — название категории; используется в каталоге товаров.
- `is_active` — признак активности категории.
- `tenant_id` — ссылка на `tenants.id`; категория принадлежит арендатору.

## brands
- `id` — UUID бренда, первичный ключ.
- `name` — название бренда; используется для группировки товаров.
- `is_active` — признак активности бренда.
- `tenant_id` — ссылка на `tenants.id`; бренд принадлежит арендатору.

## product_lines
- `id` — UUID линейки/серии, первичный ключ.
- `name` — название линейки; используется в каталоге.
- `brand_id` — ссылка на `brands.id`; определяет бренд линейки.
- `is_active` — признак активности линейки.
- `tenant_id` — ссылка на `tenants.id`.

## products
- `id` — UUID товара, первичный ключ.
- `sku` — артикул/код товара; используется для поиска и уникальности в пределах арендатора.
- `name` — наименование товара.
- `description` — описание товара, свободный текст.
- `image_url` — ссылка на изображение товара (если задано).
- `category_id` — ссылка на `categories.id` (может быть `NULL`); привязка к категории.
- `brand_id` — ссылка на `brands.id` (может быть `NULL`); привязка к бренду.
- `line_id` — ссылка на `product_lines.id` (может быть `NULL`); привязка к линейке.
- `price` — текущая цена продажи.
- `last_purchase_unit_cost` — последняя закупочная себестоимость; используется при расчёте маржинальности.
- `is_active` — флаг доступности товара.
- `tenant_id` — ссылка на `tenants.id`.

## suppliers
- `id` — UUID поставщика, первичный ключ.
- `name` — имя/название поставщика.
- `contact` — контактные данные (телефон, email и т.п.).
- `tenant_id` — ссылка на `tenants.id`.

## purchase_invoices
- `id` — UUID закупочного счёта, первичный ключ.
- `supplier_id` — ссылка на `suppliers.id` (может быть `NULL`); поставщик счёта.
- `status` — статус (`draft`, `posted`, `void`); используется для управления жизненным циклом закупки.
- `created_at` — время создания счёта.
- `tenant_id` — ссылка на `tenants.id`.

## purchase_items
- `id` — UUID позиции закупки, первичный ключ.
- `invoice_id` — ссылка на `purchase_invoices.id`; принадлежность позиции закупке.
- `product_id` — ссылка на `products.id`; закупаемый товар.
- `quantity` — количество закупки.
- `unit_cost` — цена за единицу в закупке.
- `tenant_id` — ссылка на `tenants.id`.

## stock_moves
- `id` — UUID движения склада, первичный ключ.
- `product_id` — ссылка на `products.id`; товар, по которому было движение.
- `quantity` — итоговое количество на момент фиксации.
- `delta_qty` — изменение количества (плюс/минус); используется для учёта движения.
- `reason` — причина движения (`purchase`, `sale`, `refund`, `void`, `adjustment`).
- `reference` — строковая ссылка на документ/контекст движения.
- `ref_id` — UUID документа-источника (если есть).
- `created_by_user_id` — пользователь, инициировавший движение.
- `created_at` — время фиксации движения.
- `tenant_id` — ссылка на `tenants.id`.

## stock_batches
- `id` — UUID партии склада, первичный ключ.
- `product_id` — ссылка на `products.id`; товар в партии.
- `quantity` — остаток количества в партии.
- `unit_cost` — себестоимость единицы в партии.
- `purchase_item_id` — ссылка на `purchase_items.id` (может быть `NULL`); источник партии.
- `tenant_id` — ссылка на `tenants.id`.

## sale_item_cost_allocations
- `id` — UUID распределения себестоимости, первичный ключ.
- `sale_item_id` — ссылка на `sale_items.id`; строка продажи.
- `batch_id` — ссылка на `stock_batches.id`; партия, из которой списана себестоимость.
- `quantity` — количество, списанное из партии.
- `tenant_id` — ссылка на `tenants.id`.

## sales
- `id` — UUID продажи, первичный ключ.
- `created_at` — время создания продажи.
- `created_by_user_id` — пользователь, оформивший продажу.
- `status` — статус (`completed`, `void`); используется для отмены продаж.
- `total_amount` — итоговая сумма продажи.
- `currency` — код валюты.
- `tenant_id` — ссылка на `tenants.id`.

## sale_items
- `id` — UUID позиции продажи, первичный ключ.
- `sale_id` — ссылка на `sales.id`; принадлежность позиции продаже.
- `product_id` — ссылка на `products.id` (может быть `NULL`); продаваемый товар.
- `qty` — количество товара в строке.
- `unit_price` — цена за единицу на момент продажи.
- `line_total` — сумма строки (qty × unit_price).
- `tenant_id` — ссылка на `tenants.id`.

## payments
- `id` — UUID платежа, первичный ключ.
- `sale_id` — ссылка на `sales.id`; продажа, за которую принят платеж.
- `amount` — сумма платежа.
- `currency` — валюта платежа.
- `method` — способ оплаты (`cash`, `card`, `external`).
- `status` — статус (`pending`, `confirmed`, `cancelled`).
- `reference` — внешний идентификатор/референс платежа.
- `created_at` — время создания платежа.
- `tenant_id` — ссылка на `tenants.id`.

## refunds
- `id` — UUID возврата, первичный ключ.
- `sale_id` — ссылка на `sales.id`; продажа, по которой оформлен возврат.
- `amount` — сумма возврата.
- `reason` — причина возврата.
- `created_by_user_id` — пользователь, оформивший возврат.
- `created_at` — время создания возврата.
- `tenant_id` — ссылка на `tenants.id`.

## cash_receipts
- `id` — UUID чека, первичный ключ.
- `sale_id` — ссылка на `sales.id`; продажа, по которой выдан чек.
- `receipt_id` — идентификатор чека у провайдера (уникален в рамках арендатора).
- `provider` — имя провайдера фискализации/кассы.
- `payload_json` — JSON-полезная нагрузка от провайдера.
- `created_at` — время создания чека.
- `tenant_id` — ссылка на `tenants.id`.

## cash_registers
- `id` — UUID кассы, первичный ключ.
- `name` — название кассы; используется для выбора кассы в интерфейсе.
- `type` — тип/провайдер кассы (например, `mock`).
- `config` — JSON-конфигурация кассы.
- `is_active` — признак активной кассы.
- `tenant_id` — ссылка на `tenants.id`.
