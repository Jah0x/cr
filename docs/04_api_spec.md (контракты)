# API spec (v1)

Base: /api/v1

## Auth
- session or JWT (implementation choice)
- endpoints require role-based access

## Catalog
GET/POST/PATCH/DELETE:
- /categories
- /brands
- /lines
- /products

GET /products?category_id=&brand_id=&line_id=&q=&active=

## Stock & purchasing
POST /purchase-invoices (draft)
POST /purchase-invoices/{id}/items
POST /purchase-invoices/{id}/post  -> creates moves + batches, updates avg/last
POST /purchase-invoices/{id}/void

GET /stock?filters... -> products with computed on_hand
GET /stock/moves?product_id=&from=&to=
POST /stock/adjustments (ADJUST/WRITE_OFF with reason, role-limited)

## POS sales
POST /pos/sales (OPEN)
POST /pos/sales/{id}/items
PATCH /pos/sales/{id}/items/{item_id} (qty/discount/price within limits)
POST /pos/sales/{id}/finalize
POST /pos/sales/{id}/payments
POST /pos/sales/{id}/void

Finalize rules:
- validate discount limits
- validate stock availability
- compute COGS by costing method
- create SALE_OUT moves
- mark PAID when payments cover total_due

## Reports
GET /reports/summary?from=&to=
GET /reports/by-category?from=&to=
GET /reports/by-brand?from=&to=
GET /reports/top-products?from=&to=&limit=
GET /reports/stock-alerts?threshold=
